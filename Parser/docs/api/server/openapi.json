{
  "openapi": "3.0.0",
  "info": {
    "title": "MParser Parser 节点",
    "version": "1.0.0",
    "description": "MParser Parser 节点 API 文档"
  },
  "components": {
    "schemas": {
      "Gateway": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Gateway ID"
          },
          "name": {
            "type": "string",
            "description": "Gateway名称"
          },
          "status": {
            "type": "integer",
            "description": "状态(0-离线,1-在线)"
          },
          "switch": {
            "type": "integer",
            "description": "开关(0-关闭,1-开启)"
          }
        }
      },
      "NDS": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "NDS ID"
          },
          "name": {
            "type": "string",
            "description": "NDS名称"
          },
          "status": {
            "type": "integer",
            "description": "状态(0-离线,1-在线)"
          },
          "switch": {
            "type": "integer",
            "description": "开关(0-关闭,1-开启)"
          }
        }
      },
      "Parser": {
        "type": "object",
        "required": [
          "id",
          "host",
          "port"
        ],
        "properties": {
          "id": {
            "type": "string",
            "description": "Parser ID"
          },
          "gatewayId": {
            "type": "string",
            "description": "关联的网关ID（可选）"
          },
          "name": {
            "type": "string",
            "description": "Parser名称"
          },
          "host": {
            "type": "string",
            "description": "主机地址（IP地址）"
          },
          "port": {
            "type": "integer",
            "description": "端口号",
            "default": 10002
          },
          "status": {
            "type": "integer",
            "description": "状态(0-离线,1-在线)",
            "default": 0
          },
          "switch": {
            "type": "integer",
            "description": "开关(0-关闭,1-开启)",
            "default": 0
          },
          "pools": {
            "type": "integer",
            "description": "进程池大小",
            "default": 5
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          },
          "gateway": {
            "$ref": "#/components/schemas/Gateway"
          }
        }
      },
      "ParserResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码"
          },
          "message": {
            "type": "string",
            "description": "响应消息"
          },
          "data": {
            "type": "object",
            "description": "响应数据"
          }
        }
      }
    }
  },
  "paths": {
    "/v1/start": {
      "get": {
        "summary": "启动Parser服务",
        "description": "启动Parser服务，初始化配置并启动处理任务的进程池",
        "tags": [
          "Parser API"
        ],
        "responses": {
          "200": {
            "description": "服务启动成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "Parser服务启动成功"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Parser"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "服务已在运行中",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 400
                    },
                    "message": {
                      "type": "string",
                      "example": "Parser服务已经在运行中"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "服务启动失败",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 500
                    },
                    "message": {
                      "type": "string",
                      "example": "启动Parser服务失败: {错误信息}"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/stop": {
      "get": {
        "summary": "停止Parser服务",
        "description": "停止Parser服务，关闭进程池和数据库连接",
        "tags": [
          "Parser API"
        ],
        "responses": {
          "200": {
            "description": "服务停止成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "Parser服务已停止"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "服务未启动",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 400
                    },
                    "message": {
                      "type": "string",
                      "example": "Parser服务未启动"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "服务停止失败",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 500
                    },
                    "message": {
                      "type": "string",
                      "example": "停止Parser服务失败: {错误信息}"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/": {
      "get": {
        "summary": "程序信息",
        "description": "获取程序信息",
        "tags": [
          "系统"
        ],
        "responses": {
          "200": {
            "description": "成功获取程序信息",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "app_name": {
                          "type": "string",
                          "example": "MParser Parser"
                        },
                        "app_id": {
                          "type": "string"
                        },
                        "version": {
                          "type": "string",
                          "example": "1.0.0"
                        },
                        "docs": {
                          "type": "object",
                          "properties": {
                            "swagger": {
                              "type": "string",
                              "example": "/docs"
                            },
                            "redoc": {
                              "type": "string",
                              "example": "/redoc"
                            },
                            "openapi": {
                              "type": "string",
                              "example": "/openapi.json"
                            }
                          }
                        }
                      }
                    },
                    "message": {
                      "type": "string",
                      "example": "成功"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "环境状态检查",
        "description": "健康检查接口，返回系统健康状态和资源使用情况",
        "tags": [
          "系统"
        ],
        "responses": {
          "200": {
            "description": "成功获取系统状态",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "example": "健康"
                        },
                        "cpu": {
                          "type": "object",
                          "properties": {
                            "usage": {
                              "type": "number",
                              "example": 12.5
                            },
                            "cores": {
                              "type": "integer",
                              "example": 8
                            }
                          }
                        },
                        "memory": {
                          "type": "object",
                          "properties": {
                            "total": {
                              "type": "number",
                              "example": 16384
                            },
                            "used": {
                              "type": "number",
                              "example": 8192
                            },
                            "free": {
                              "type": "number",
                              "example": 8192
                            },
                            "usage": {
                              "type": "number",
                              "example": 50
                            }
                          }
                        },
                        "disk": {
                          "type": "object",
                          "properties": {
                            "total": {
                              "type": "number",
                              "example": 512000
                            },
                            "used": {
                              "type": "number",
                              "example": 256000
                            },
                            "free": {
                              "type": "number",
                              "example": 256000
                            },
                            "usage": {
                              "type": "number",
                              "example": 50
                            }
                          }
                        },
                        "uptime": {
                          "type": "string",
                          "example": "10天12小时30分钟"
                        }
                      }
                    },
                    "message": {
                      "type": "string",
                      "example": "成功"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}